<!-- Template inheritance: this template is the parent, while others are the children-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  {% block tags %}{% endblock %}
  <link rel="stylesheet" type="text/css" href="{{ url_for ('static', filename = 'main.css')}}" />
  <link rel="stylesheet" type="text/css" href="{{ url_for ('static', filename = 'message.css')}}" />
  {% if title %}
  <title>{{company_name|e}} - {{ title|e }}</title>
  {% else %}
  <title>{{company_name|e}}</title>
  {% endif %}
  <script>
    document.cookie =
      "time_zone=" + Intl.DateTimeFormat().resolvedOptions().timeZone;
  </script>
  <link rel="icon" type="image/png" href="/static/images/Favicon.png" />
</head>

<body>
  <header>
    <nav class="header-navbar-container">
      <a class="home-link" href="/">{{company_name|e}}</a>
      <div class="hamburger">
        <img onclick="hamburgerToggle()" class="icon" src="{{ url_for ('static', filename = 'icons/menu-icon.svg')}}"
          alt="Hamburger Icon" />
      </div>
      <div id="nav-id" class="header-navigation">
        <div class="main-nav-links">
          <a class="header-link" href="/about">About Us </a>
          <a class="header-link" href="/products">Products</a>
          <a class="header-link" href="/forums">Forums</a>
          <a class="header-link" href="/blog">Blog</a>
          <a class="header-link" href="/tickets?status=all">Tickets</a>
          <a class="header-link" href="/calendar">Calendar</a>
          {% if is_admin %}
          <div class="dropdown">
            <div class="dropdown-btn">Tools</div>
            <div class="dropdown-content">
              <a href="/company/editor">Company</a>
              <a href="/orders/editor">Orders</a>
              <a href="/customers/editor">Customers</a>
              <a href="/blog/create">New Blog</a>
            </div>
          </div>
          {% endif %}
        </div>
        <div class="main-nav-links">
          {% if current_user.is_authenticated %}
          <a class="header-link" href="/profile">Profile</a>
          <a class="header-link" href="{{ url_for('auth.logout') }}">Logout</a>
          {% endif %} {% if not current_user.is_authenticated %}
          <a class="header-link" href="/login">Login</a>
          <a class="header-link" href="/signup">Sign Up</a>
          {% endif %}
        </div>
      </div>
    </nav>
  </header>
  <main>

    {% block content %}{% endblock %}
    <div id="message-layout">
      <div id="message-display" class="full-page-message">
        <div class="full-page-scroll-container">
          <div class="top-bar">
            <h2 class="section-title"></h2>
            <div class="main-nav-links"></div>
            <div class="right-nav-container">
              <button onclick="closeMessage()" id="close-message-btn">
                <strong> X </strong>
              </button>
            </div>
          </div>
          <div class="full-page-scroll-content">
            <div class="content-section">
              <div class="content-section-div-1">
                <div class="content-section-p" class="full-page-scroll-container" id="user-section">
                  <div class="message-top-bar">
                    <p class="top-bar-title">USERS</p>
                    <div class="main-nav-links"></div>
                    <div class="right-nav-container">
                      <button onclick="displayUser()" id="user-btn">_</button>
                    </div>
                  </div>
                  <div class="message-grid-container" id="user-container">
                    {% for user in users %}
                    <div class="message-grid-item">{{user['name']}}</div>
                    {% endfor %}
                  </div>
                </div>
                <div class="content-section-p" class="full-page-scroll-container" id="group-section">
                  <div class="message-top-bar">
                    <p class="top-bar-title">GROUPS</p>
                    <div class="main-nav-links"></div>
                    <div class="right-nav-container">
                      <button onclick="displayGroup()" id="group-btn">
                        _
                      </button>
                    </div>
                  </div>
                  <div class="message-grid-container" id="group-container">
                    <div>
                      {% for group in groups %}
                      <div class="message-grid-item">{{group}}</div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="content-section-div-2">
                <div class="message-display">
                  <div class="message-display-sender" class="full-page-scroll-container">
                    <!-- Content Now Dynamically Filled in by JS SCRIPT-->
                  </div>
                  <div class="message-display-receiver">
                    <!-- Content Now Dynamically Filled in by JS SCRIPT-->
                  </div>
                </div>
                <form class="message-form" method="POST" action="">
                  <div class="message-form-section">
                    <input type="text" class="display_name" name="chat_name" id="chat_name" placeholder="Display Name:">
                    <textarea rows="6" class="message_text" name="chat_message" id="chat_message"
                      placeholder="Text your message..."> </textarea>
                    <input type="submit" value="Send" />
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer>
    <p>Tobu Pengin {{copyright|e}}</p>
    <div>
      <button onclick="displayBtn()" id="message-btn">Chat</button>
    </div>
  </footer>

  <script src="{{ url_for ('static', filename = 'javascript/scripts.js')}}"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
    integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
    crossorigin="anonymous"></script>
  <script type="text/javascript">
    const socket = io();
    const sent_messages = document.querySelector(".message-display-sender");



    socket.on('connect', function () {
      console.log("We have a new connection!")

      const form = $('form').on('submit', function (e) {
        e.preventDefault()
        let display_name = $('input.display_name').val()
        let message_text = $('textarea.message_text').val()

        socket.emit('message sent', {
          chat_name: display_name,
          chat_message: message_text
        })
        $('input.message_text').val('').focus()
      })
    })



    socket.on('update chat', function (data) {
      const msgSection = document.createElement('div');
      msgSection.className = "text-section";
      const newMessage = document.createElement('div');
      newMessage.className = "text-section-s"
      newMessage.innerHTML = data.chat_message;
      const msgSpace = document.createElement('div');
      msgSpace.className = "text-section-s";


      msgSection.appendChild(newMessage)
      msgSection.appendChild(msgSpace)
      sent_messages.appendChild(msgSection)


      //updateChat();
    });



  </script>


  {% block captchaScript %} {% endblock %}
</body>

</html>